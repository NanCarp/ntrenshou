<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>客户管理-新增/修改</title>

    <!-- Bootstrap Core CSS -->
    <link href="../../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../../../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
	<link href="../../../css/admin.css" rel="stylesheet">
	<link href="../../../resource/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
	<style type="text/css">
		body { margin:0 15px;}
		form { margin-top:20px;}
		label { padding-top:6px;padding-right:0;}
	</style>
	
    <!-- Custom Fonts -->
    <link href="../../../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<style>
 th{text-align: center;}
 td{text-align: center;}

</style>
<body>
<form class="form-horizontal" role="form" style="margin-top: 20px" id="defaultForm">
	<#if company??>
	<input id="id" name="id" value="${company.id}" hidden="">
	<div style="display: inline-block;margin-left: 20px">
	    <div class="form-group">
	        <label class="col-xs-4 control-label text-right" for="company_name">公司名称：</label>
	        <div class="col-xs-8">
	            <input class="form-control text-left" id="company_name" type="text" placeholder="公司名称" name="company_name" value="${company.company_name!}"/>
	        </div>
	    </div>
	    <div class="form-group">
	        <label class="col-xs-4 control-label text-right" for="remark" style="padding-top: 0">备注：</label>
	        <div class="col-xs-8">
	        	<input style="padding-right: 2px" class="form-control text-left" id="remark" type="text" placeholder="备注" name="remark" value="${company.remark!}"/>
	        </div>
	    </div>
	</div>
	<div style="display: inline-block;margin-left: 40px;margin-bottom:49px">
	     <div class="form-group">
	        <label class="col-xs-4 control-label text-right" for="company_address">公司地址：</label>
	        <div class="col-xs-8">
	            <input style="padding-right: 2px" class="form-control text-left" id="company_address" type="text" placeholder="公司地址" name="company_address" value="${company.company_address!}"/>
	        </div>
	    </div>
	</div>
	<#else>
	<input id="id" name="id" value="" hidden="">
	<div style="display: inline-block;">
	    <div class="form-group">
	        <label class="col-xs-4 control-label text-right" for="company_name">公司名称：</label>
	        <div class="col-xs-8">
	            <input class="form-control text-left" id="company_name" type="text" placeholder="公司名称" name="company_name"/>
	        </div>
	    </div>
	    <div class="form-group">
	        <label class="col-xs-4 control-label text-right" for="remark" style="padding-top: 0">备注：</label>
	        <div class="col-xs-8">
	        	<input style="padding-right: 2px" class="form-control text-left" id="remark" type="text" placeholder="备注" name="remark"/>
	        </div>
	    </div>
	</div>
	<div style="display: inline-block;margin-left: 40px;margin-bottom:49px">
	     <div class="form-group">
	        <label class="col-xs-4 control-label text-right" for="company_address">公司地址：</label>
	        <div class="col-xs-8">
	            <input style="padding-right: 2px" class="form-control text-left" id="company_address" type="text" placeholder="公司地址" name="company_address"/>
	        </div>
	    </div>
	</div>
	</#if>
	<div>
<div id="wrapper">
	<div class="panel-body" style="padding-bottom:0px;">
		<div class="panel panel-default">		
			<div class="panel-heading">					
				<div class="container container-fluid" >				
					<div class="row">                         	    		                                            		                   			                   			
						<div class="col-sm-2 col-xs-6 head_1" style="padding-left: 0;margin-left: 0">
		                    <button class="btn btn-success" type="button" onclick="_add()">+ 新增联系人</button>
		                </div>	          
                        <div class="col-sm-2 col-xs-6 head_1" style="padding-left: 0;margin-left: 0">
		                     <button class="btn btn-4" type="button" onclick="_batchDelete()">- 删除联系人</button>
		                </div>                    									                            									                 
					</div>				
				</div>
			</div>		
			<table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
           <thead>
              <tr>
              	<th><input type="checkbox" id="checkAll"></th>
                <th>序号</th>
                <th>姓名</th>
                <th>电话</th>
                <th>QQ</th>
                <th>微信</th>
                <th>e_mail</th>
                <th>备注</th>
                <th>操作</th>
              </tr>
              </thead>
              <tbody>
              	<#if company_contact?? &&company_contact?size gt 0>
              	<#list company_contact as contant>
              		<tr>
              			<td><input type="checkbox" name="sub" value=""></td>
              			<td></td>
              			<td>${contant.name!}</td>
              			<td>${contant.call_num!}</td>
              			<td>${contant.QQ!}</td>
              			<td>${contant.wechat!}</td>
              			<td>${contant.e_mail!}</td>
              			<td>${contant.remark!}</td>
              			<td><button class="btn btn-xs btn-3" type="button"  onclick="_edit(this)">编辑</button></td>
              		</tr>
              	</#list>
              	</#if>               
              </tbody>
          </table>
		</div>             
	</div>
</div>
	</div>
    <div class="form-group" style="padding-left: 16px">
        <div class="col-xs-8">
            <button id="v" type="submit" class="btn btn-primary">　保存　</button>
        </div>
    </div>
</form>
<!-- jQuery -->
<script src="../../../vendor/jquery/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="../../../vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Metis Menu Plugin JavaScript -->
<script src="../../../vendor/metisMenu/metisMenu.min.js"></script>
<script src="../../../resource/layer/layer.js"></script>
<script src="../../../resource/layui/layui.js"></script>
<!-- Custom Theme JavaScript -->
<script src="../../../resource/bootstrapvalidator/js/bootstrapValidator.min.js"></script>
<script src="../../../js/common/admin.js"></script>
<script type="text/javascript">
$(function(){
	// 表单校验
	$('form').bootstrapValidator({
		message: 'This value is not valid',
		feedbackIcons: {
			valid: 'glyphicon glyphicon-ok',
			invalid: 'glyphicon glyphicon-remove',
			validating: 'glyphicon glyphicon-refresh'
		},
		fields: {
			company_name: {
				validators: {
					notEmpty: {
						message: '不能为空!'
					},
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
				}
			}
			,remark: {
				validators: {
	                stringLength: {
	                    min: 0,
	                    max: 20,
	                    message: '最多20个字符'
	                }
				}
			}
			,company_address: {
				validators: {
					notEmpty: {
						message: '不能为空!'
					},
                    stringLength: {
                        min: 0,
                        max: 40,
                        message: '最多40个字符'
                    }
				}
			}
		}
	});
})
.on('success.form.bv', function(e) {
	e.preventDefault();
	var list = new Array();
	$("tbody tr").each(function(k,v){
		var data = {"name":$(v).find("td").eq(2).html(),"call_num":$(v).find("td").eq(3).html()
				,"QQ":$(v).find("td").eq(4).html(),"wechat":$(v).find("td").eq(5).html()
				,"e_mail":$(v).find("td").eq(6).html(),"remark":$(v).find("td").eq(7).html()};
		list[k] = data;
	})
	var id = $("#id").val();
	var company_name = $("#company_name").val();
	var company_address = $("#company_address").val();
	var remark =$("#remark").val();
	$.post("/database/customes/saveCustom", {"list":JSON.stringify(list),"company_name":company_name,"company_address":company_address,"remark":remark,"id":id}, function(result) {
		if (result) {
            parent.layer.msg("保存成功", {time: 2000}, function(){
                layer_close();
                parent.parent.refresh_iframe();
            });
        } else {
            parent.layer.msg(result.tips, {time: 2000});
        }
		
	});
});

function _add(){
	open_window('新增联系人','/database/customes/addContant', 400, 400);
}

//接受子页面添加参数
function addcontant(data){
	if(data.position!=null&&data.position!=""){
		$("tbody tr").each(function(k,v){
			if(data.position==k+1){
				$(v).replaceWith("<tr>"
			        	  +"<td><input type='checkbox' name='sub' value=''></td>"
			              +"<td>1</td>"
			              +"<td>"+data.name+"</td>" 
			              +"<td>"+data.call_num+"</td>"    
			              +"<td>"+data.QQ+"</td>"
			              +"<td>"+data.wechat+"</td>"
			              +"<td>"+data.e_mail+"</td>"
			              +"<td>"+data.remark+"</td>"
			              +"<td><button class='btn btn-xs btn-3'type='button'  onclick='_edit(this)'>编辑</button></td>"
			              +"</tr>")
			}
		})
	}else{
		$("tbody").append("<tr>"
	        	  +"<td><input type='checkbox' name='sub' value=''></td>"
	              +"<td>1</td>"
	              +"<td>"+data.name+"</td>" 
	              +"<td>"+data.call_num+"</td>"    
	              +"<td>"+data.QQ+"</td>"
	              +"<td>"+data.wechat+"</td>"
	              +"<td>"+data.e_mail+"</td>"
	              +"<td>"+data.remark+"</td>"
	              +"<td><button class='btn btn-xs btn-3'type='button'  onclick='_edit(this)'>编辑</button></td>"
	              +"</tr>");
	}        		
}

//删除页面数据
function _batchDelete(){
	if($("input[name='sub']:checked").length == 0){
		parent.layer.msg("请至少选择一条数据", {time: 2000});
	}else{
		$("input[name='sub']:checked").each(function(k,v){
			   $(v).parent().parent().remove();
			   sort();
		   })
	}
}

//修改页面数据
function _edit(_obj){
	var position = $(_obj).parent().parent().find("td").eq(1).html();
	var name = $(_obj).parent().parent().find("td").eq(2).html();
	var call_num = $(_obj).parent().parent().find("td").eq(3).html();
	var QQ = $(_obj).parent().parent().find("td").eq(4).html();
	var wechat = $(_obj).parent().parent().find("td").eq(5).html();
	var e_mail = $(_obj).parent().parent().find("td").eq(6).html();
	var remark = $(_obj).parent().parent().find("td").eq(7).html();
	var data = "name="+name+"&call_num="+call_num+"&QQ="+QQ+"&wechat="+wechat+"&e_mail="+e_mail+"&remark="+remark+"&position="+position;
	open_window('修改联系人',"/database/customes/addContant?"+data, 400, 400);
}
//页面序号排序
function sort(){
	if($("tbody").find("tr").length==0){
		$("tbody").append("<tr class='flag'><td colspan='9' style='text-align: center;'>暂无联系人，请先添加联系人</td></tr>");
	}else{
		$("tbody").find(".flag").remove();
	}
	$("tbody tr").each(function(k,v){
		var index = k+1;
		$(v).find("td").eq(1).html(index);
	})
}
sort();
</script>
</body>

</html>
