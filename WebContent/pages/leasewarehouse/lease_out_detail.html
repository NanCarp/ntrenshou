<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>入库明细（国内）</title>

    <!-- Bootstrap Core CSS -->
    <link href="../../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../../../css/common/common.css" rel="stylesheet">
    <link href="../../../css/admin.css" rel="stylesheet">
    <link href="../../../resource/bootstrapvalidator/css/bootstrapValidator.min.css" rel="stylesheet">
    <link href="../../../resource/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <style type="text/css">
        /* body { margin:0 45px 0 0;} */
        form { margin-top:20px;}
        label { padding-top:6px;padding-right:0;}
        .container {
            width: 100% !important;
        }
        tbody .form-control {
            margin-left: 10%;
            width: 80%;
        }
    </style>
	
    <!-- Custom Fonts -->
    <link href="../../../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
<form class="form-horizontal" role="form" style="margin-top:20px;" id="defaultForm">
	<div class="container">
		<#if Record??>
		<input type="hidden" name="id" value="${record.id}">
		<div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="storage_location">入库单号：</label>
                <div class="col-xs-6">
                    <input class="form-control" placeholder="库位" name="storage_location" id="storage_location" value="${stockInDomestic.storage_location!}">
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="in_date">入库日期：</label>
                <div class="col-xs-6">
                    <input class="form-control form_datetime" placeholder="日期" name="in_date" id="in_date" value="${stockInDomestic.in_date!}">
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="storage_location">客户名称：</label>
                <div class="col-xs-6">
                    <input class="form-control" placeholder="库位" name="storage_location" id="storage_location" value="${stockInDomestic.storage_location!}">
                </div>
            </div>
            <!-- <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="company_name">物流公司名称：</label>
                <div class="col-xs-6">
                    <input class="form-control" placeholder="物流公司名称" name="company_name" id="company_name" value="${stockInDomestic.company_name!}">
                    <select class="form-control" name="company_name" id="company_name">
                        <option value="">物流公司</option>
                        <#if companyList?? && companyList?size gt 0>
                        <#list companyList as company>
                        <option value="${stockInDomestic.company_name!}" <#if company.company_name == stockInDomestic.company_name >selected</#if> >${company.company_name}</option>
                        </#list>
                        </#if>
                    </select>
                </div>
            </div> -->
        </div>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="batch_no">对应仓库：</label>
                <div class="col-xs-6">
                    <input class="form-control" placeholder="对应仓库" name="batch_no" id="batch_no" value="${stockInDomestic.batch_no!}" readonly>
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="tray_no">摆放位置：</label>
                <div class="col-xs-6">
                    <input class="form-control" placeholder="托盘号" name="tray_no" id="tray_no" value="${stockInDomestic.tray_no!}" readonly>
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-6 control-label text-right" for="in_quantity">入库状态：</label>
                <div class="col-xs-6">
                    <input class="form-control" placeholder="数量（片）" name="in_quantity" id="in_quantity" value="${stockInDomestic.in_quantity!}">
                </div>
            </div>
        </div>
	    <#else>
        <div class="col-xs-6">
            <div class="form-group">
                <label class="col-xs-4 control-label text-left" for="storage_location">出库单号：</label>
                <div class="col-xs-8">
                    <input class="form-control" placeholder="自动生成" name="storage_location" id="storage_location" readonly>
                </div>
            </div>
            
	   	</div>
	   	<div class="col-xs-6">
	   		<div class="form-group">
                <label class="col-xs-4 control-label text-left" for="in_date">出库日期：</label>
                <div class="col-xs-8">
                    <input class="form-control form_datetime" placeholder="出库日期" name="in_date" id="in_date" >
                </div>
            </div>
	   	</div>
	   	<div class="col-xs-12">
        <!-- <div class="panel panel-default">
        <div class="panel-heading"> -->
            <div class="container container-fluid">
                <div class="row">
                    <div class="col-sm-2 col-xs-2 head_3">
                        <button type="button" class="btn btn-success" onclick="_newRow()">新增行</button>
                    </div>
                    <div class="col-sm-2 col-xs-2 head_3">
                        <button type="button" class="btn btn-4" onclick="_deleteRow()">删除行</button>
                    </div>
                    <div class="col-sm-2 col-xs-2 head_1">
                        <button  type="button" class="btn btn-3" onclick="_editRow()">编辑</button>
                    </div>
                    <!-- <div class="col-sm-2 col-xs-2 head_1">
                        <button class="btn btn-11" onclick="_saveRow()">保存</button>
                    </div> -->
                </div>
            </div>
        <!-- </div> -->
        <!-- <div class="panel-body"> -->
            <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="checkAll"></th>
                        <th>序号</th>
                        <th>产品</th>
                        <th>规格</th>
                        <th>单位</th>
                        <th>出库数量</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <#if productList?? && productList?size gt 0>
                    <#list productList as product>
                    <tr>
                        <td><input type="checkbox" name="sub" _id="${product.id}"></td>
                        <td>${product_index+1}</td>
                        <td>${product.name!}</td>
                        <td>${product.specification!}</td>
                        <td>${product.unit!}</td>
                        <td>${product.out_quantity!}</td>
                    </tr>
                    </#list>
                    </#if>
                </tbody>
            </table>
        <!-- </div> --> <!-- panel-body -->
        <!-- </div> --> <!-- panel panel-default -->
        </div>
	   	
	   	<div class="col-xs-12">
		    <div class="form-group">
		        <label class="col-xs-10 control-label" for="v"></label>
		        <div class="col-xs-2">
		            <!-- <button type="button" class="btn btn-10" id="cancel">取消</button> -->
		            <button id="v" type="submit" class="btn btn-11">　 保存 　</button>
		       	</div>
		    </div>
	   	</div>
	   	
	    </#if>
    </div>
</form>
<!-- jQuery -->
<script src="../../../vendor/jquery/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="../../../vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="../../../resource/layer/layer.js"></script>
<script src="../../../resource/layui/layui.js"></script>
<script src="../../../resource/bootstrapvalidator/js/bootstrapValidator.min.js"></script>
<script src="../../../resource/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script> 
<script src="../../../resource/bootstrap-datetimepicker/js/moment-with-locales.min.js"></script>
<script src="../../../resource/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script type="text/javascript">
//日期控件
$(".form_datetime").datetimepicker({
	format: "yyyy-mm-dd",
	autoclose: true,
	todayBtn: false,
	todayHighlight: true,
	showMeridian: true,
	pickerPosition: "bottom-right",
	language: 'zh-CN',//中文，需要引用zh-CN.js包
	startView: 2,// // 日视图
	minView: 2,
});
$(function(){
	// 表单校验
	$('form').bootstrapValidator({
		message: 'This value is not valid',
		feedbackIcons: {
			valid: 'glyphicon glyphicon-ok',
			invalid: 'glyphicon glyphicon-remove',
			validating: 'glyphicon glyphicon-refresh'
		},
		fields: {
			"in_date": {
				validators: {
					notEmpty: {
						message: '不能为空!'
					},
				}
			},
			"storage_location": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\u0391-\uFFE5 ]{1,}$/,
                        message: '请输入正确的库位'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "company_name": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\u0391-\uFFE5 ]{1,}$/,
                        message: '请输入正确的公司名'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "material_no": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9]{1,}$/,
                        message: '请输入正确的物料号'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "material": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9_\u0391-\uFFE5 ]{1,}$/,
                        message: '请输入正确的托盘号'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "batch_no": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9]{1,}$/,
                        message: '请输入正确的批次号'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "tray_no": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[a-zA-Z0-9]{1,}$/,
                        message: '请输入正确的托盘号'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "in_quantity": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[0-9]+$/,
                        message: '请输入正确的数量'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "in_tray_quantity": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[0-9]+$/,
                        message: '请输入正确的数量'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            },
            "module_power": {
                validators: {
                    notEmpty: {
                        message: '不能为空!'
                    },
                    regexp: {
                        regexp: /^[0-9]+$/,
                        message: '请输入正确的功率'
                    },
                    stringLength: {
                        min: 0,
                        max: 20,
                        message: '最多20个字符'
                    }
                }
            }
		}
	});
})
.on('success.form.bv', function(e) {
	e.preventDefault();
	$.post("/leasewarehouse/leaseOut/save", $('#defaultForm').serialize(), function(result) {
		if (result.isSuccess) {
            parent.layer.msg(result.tips, {time: 2000}, function(){
                layer_close();
                parent.parent.refresh_iframe();
            });

        } else {
            parent.layer.msg(result.tips, {time: 2000});
        }
		
	});
});

//取消
$('#cancel').on("click",function() {
	layer_close();
});

//表操作
var count = $('#tbody tr').length; // 当前记录条数
// 记录为零时，新增一行
if (count === 0) {
    _newRow();
}
// 新增行
function _newRow() {
    var $tbody = $('#tbody');
    var row = '<tr class="edit">'+
                  '<td><input type="checkbox" name="sub" _id=""></td>'+
                  '<td name="count">'+ (count+1) +'</td>'+
                  '<td><div class="form-group form-group-sm"><input class="form-control" type="text" name="contacts" value=""/></div></td>'+
                  '<td><div class="form-group form-group-sm"><input class="form-control" type="text" name="phone" value=""/></div></td>'+
                  '<td><div class="form-group form-group-sm"><input class="form-control" type="text" name="email" value=""/></div></td>'+
                  '<td><div class="form-group form-group-sm"><input class="form-control" type="text" name="email" value=""/></div></td>'+
              '</tr>';  
    $tbody.append(row);
    // 绑定校验
    //bind();
    //$('#f1').data("bootstrapValidator").resetForm();
    count++;
}
// 删除行
function _deleteRow() {
    // 获取选中记录数量
    var amount = $(":checked[name='sub']").length;
    // 如果没有选择，提示勾选至少一条数据
    if (amount === 0) {
        layer.msg('请至少选择一条记录', {time: 2000});
        return;
    }
    // 移除勾选记录
    $(":checked[name='sub']").each(function(){
        $(this).parent().parent().remove();
    });
    // 更新序号
    var i = 0;
    $('#tbody tr').each(function() {
        i++;
        $(this).find('td').eq(1).html(i);
    });
    // 更新当前记录数
    count = i;
    // 记录为零时，新增一行
    if (count === 0) {
        _newRow();
    }
    // 清除勾选
    $("#checkAll").prop("checked" , false);
}
// 编辑行
function _editRow() {
    // 获取选中记录数量
    var amount = $(":checked[name='sub']").length;
    // 如果没有选择，提示勾选至少一条数据
    if (amount === 0) {
        layer.msg('请至少选择一条记录', {time: 2000});
        return;
    }
    // 内容改为 input
    $(":checked[name='sub']").each(function(){
        console.log(this);
        var $tr = $(this).parent().parent();
        var type = $tr.attr('class');
        console.log(type);
        if("edit" === type) {
            return true; // 跳过编辑状态的记录
        }
        var $tdList = $tr.find("td");
        var index = $tdList.eq(1).html();
        var contact = $tdList.eq(2).html();
        var phone = $tdList.eq(3).html();
        var email = $tdList.eq(4).html();
        console.log("contact: "+contact+" phone: "+phone+" email: "+email);
        var row = 
                '<td><input type="checkbox" name="sub" _id=""></td>'+
                '<td name="count">'+ index +'</td>'+
                '<td><div class="form-group"><input class="form-control " type="text" name="contacts" value=""/></div></td>'+
                '<td><div class="form-group"><input class="form-control" type="text" name="phone" value=""/></div></td>'+
                '<td><div class="form-group"><input class="form-control" type="text" name="phone" value=""/></div></td>'+
                '<td><div class="form-group"><input class="form-control" type="text" name="email" value=""/></div></td>';
        $tr.empty().append(row);
        var $inputList = $tr.find("input");
        $inputList.eq(1).val(contact);
        $inputList.eq(2).val(phone);
        $inputList.eq(3).val(email);
        $tr.attr('class','edit'); // 编辑状态
    });
    // 清除勾选
    $("input[name='sub']").prop("checked", false);
    $("#checkAll").prop("checked" , false);
}
//全选、全不选
$("#checkAll").click(function() {
    $("input[name='sub']").prop("checked", this.checked);
});
$("input[name='sub']").click(function() {
    var $subs = $("input[name='sub']");
    $("#checkAll").prop("checked" , $subs.length == $subs.filter(":checked").length ? true :false);
});

</script>
</body>

</html>
